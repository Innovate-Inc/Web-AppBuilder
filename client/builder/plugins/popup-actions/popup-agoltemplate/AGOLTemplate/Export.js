//>>built
require({cache:{"url:builder/plugins/popup-actions/popup-agoltemplate/AGOLTemplate/templates/Export.html":'\x3cdiv\x3e\r\n  \x3cp style\x3d"display:block;" class\x3d"message-div" data-dojo-attach-point\x3d"templateTitle"\x3e${nls.templateTitle}\x3c/p\x3e\r\n  \x3cp style\x3d"display:none;" class\x3d"message-div" data-dojo-attach-point\x3d"message1"\x3e\x3c/p\x3e\r\n  \x3cdiv style\x3d"display:none;" class\x3d"explain-div" data-dojo-attach-point\x3d"explain1"\x3e\x3c/div\x3e\r\n\r\n  \x3cdiv class\x3d"item-info-box" data-dojo-attach-point\x3d"itemInfoBox" \x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e'}});
define("dojo/_base/declare dojo/_base/lang dijit/dijit dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/Export.html dojo/Deferred dojo/promise/all dojo/dom-style dojo/dom-attr jimu/dijit/Message jimu/dijit/LoadingShelter builder/portalUtils ./ExportMessage jimu/dijit/Popup builder/dijit/ItemInfo".split(" "),function(m,c,B,r,s,t,g,u,v,w,x,y,p,h,z,A){return m([r,s],{templateString:t,baseClass:"export-agoltemplate",_templateUrl:null,_temlateJson:null,pluginManager:null,_afterAddItemOfExportCallback:null,
startup:function(){this.popupDlg()},popupDlg:function(b){this._initDlgPage();this.popup=new z({content:this,container:"main-page",titleLabel:this.nls.title2,width:669,autoHeight:!0,buttons:[{label:this.nls.ok,onClick:c.hitch(this,this._onNextClick)},{label:this.nls.cancel,onClick:c.hitch(this,this._onCancelClick)}]})},_initDlgPage:function(){window.isXT&&(w.set(this.explain1,"innerHTML",this.nls.explain1),v.set(this.explain1,"display","block"));this.itemInfoDijit=new A({itemInfo:this.getDefaultAppInfo()});
this.itemInfoDijit.placeAt(this.itemInfoBox)},getDefaultAppInfo:function(){return{name:"",description:this.nls.templateDefaultSnippet,tags:["template"],folderId:"",sharing:void 0}},_onNextClick:function(){var b=this.itemInfoDijit.getProperties();if(b.name&&b.tags){var e=new y;e.placeAt(this.popup.domNode);e.startup();this.exportTemplate(b,this._templateUrl,this._temlateJson,this._afterAddItemOfExportCallback).then(c.hitch(this,function(b){this.close();e.destroy();h._exportedMessage(b,this.nls.exportMessageTitle,
this.nls)}),c.hitch(this,function(b){this.close();e.destroy();h._exportedMessage(b,this.nls.exportMessageTitle,this.nls)}))}else new x({message:this.nls.noTitleMessage})},_onCancelClick:function(){this.close()},close:function(){this.popup.close()},exportTemplate:function(b,e,h,m){var d=new g,k=new g,l=new g,n=new g,f="http://"+window.location.host+window.location.pathname,q=f.indexOf("index.html");-1!==q&&(f=f.slice(0,q));f+="builder/plugins/popup-actions/popup-agoltemplate/css/images/templateThumbnail.jpg";
p.getPortal(window.portalUrl).getUser().then(function(a){k.resolve(a)},function(a){k.reject(a);console.error(a.message||a);d.reject({itemId:null,message:this.nls.exportTemplateFailed5})});k.then(c.hitch(this,function(a){var c={title:b.name,snippet:b.description,tags:b.tags,url:e,thumbnailurl:f,type:"Web Mapping Application",typeKeywords:"Configurable, JavaScript",text:h};b.folderId===a.username&&(b.folderId="");a.addItem(c,b.folderId).then(function(a){a.success?(l.resolve(a),m(a.id)):(console.error(a.message||
""),l.reject(this.nls.exportTemplateFailed1))},function(a){l.reject(a);console.error(a.message||a);d.reject({itemId:null,message:this.nls.exportTemplateFailed1})})}));p.getTemplatesGroup(window.portalUrl).then(c.hitch(this,function(a){n.resolve(a)}),function(a){n.reject(a);console.error(a.message||a);d.reject({itemId:null,message:this.nls.exportTemplateFailed2})});u({user:k,itemRes:l,templateGroup:n}).then(c.hitch(this,function(a){a.user.shareItem({groups:a.templateGroup.id},a.itemRes.id,b.folderId).then(c.hitch(this,
function(b){-1===b.notSharedWith.indexOf(a.templateGroup.id)?d.resolve({itemId:a.itemRes.id,message:this.nls.exportSuccessful}):d.reject({itemId:a.itemRes.id,message:this.nls.exportTemplateFailed3,type:"no_permission_to_share"})}),function(b){console.error(b.message||b);d.reject({itemId:a.itemRes.id,message:this.nls.exportTemplateFailed4})})}));return d}})});