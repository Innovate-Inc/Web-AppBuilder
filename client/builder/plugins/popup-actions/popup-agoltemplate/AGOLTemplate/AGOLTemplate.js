//>>built
require({cache:{"url:builder/plugins/popup-actions/popup-agoltemplate/AGOLTemplate/templates/AGOLTemplate.html":'\x3cdiv\x3e\r\n  \x3c!--div class\x3d"front-div" data-dojo-attach-point\x3d"frontDiv"--\x3e\r\n    \x3c!--div class\x3d"header-div" data-dojo-attach-point\x3d"headerDiv"\x3e\r\n      \x3cspan\x3e${nls.title}\x3c/span\x3e\r\n      \x3cimg src\x3d"builder/css/images/cancel.png" alt\x3d"img" data-dojo-attach-event\x3d"onclick:_onCancelClick"\x3e\x3c/img\x3e\r\n    \x3c/div--\x3e\r\n\r\n    \x3cdiv class\x3d"content-part" data-dojo-attach-point\x3d"contentPart"\x3e\r\n      \x3cdiv class\x3d"tree-part jimu-float-leading" data-dojo-attach-point\x3d"treePart"\x3e\r\n        \x3cdiv class\x3d"left-part-title"\x3e${nls.appNameTitle}${app.name}\x3c/div\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cdiv class\x3d"right-part jimu-float-leading" data-dojo-attach-point\x3d"leftPart"\x3e\r\n        \x3cdiv class\x3d"right-part-head" \x3e\r\n          \x3cspan data-dojo-attach-point\x3d"rightPartHeadText"\x3e${nls.rightPartHead}\x3c/span\x3e\r\n          \x3cdiv class\x3d"review-json-div" data-dojo-attach-point\x3d"reviewJsonDiv" data-dojo-attach-event\x3d"onclick:_onReviewJsonDivClick" style\x3d"display:none"\x3e${nls.viewJsonCode}\x3c/div\x3e\r\n          \x3cdiv class\x3d"review-json-back-div" style\x3d"display: none" data-dojo-attach-point\x3d"reviewJsonBackDiv" data-dojo-attach-event\x3d"onclick:_onReviewJsonBackDivClick"\x3e${nls.viewJsonBack}\x3c/div\x3e\r\n\r\n        \x3c/div\x3e\r\n\r\n        \x3cdiv class\x3d"right-part-subhead"\x3e\r\n          ${nls.rightPartSubhead}\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"category-part" data-dojo-attach-point\x3d"categoryPart"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"show-json-div" data-dojo-attach-point\x3d"showJsonDiv"\x3e\r\n          \x3cdiv class\x3d"show-json-content-div" data-dojo-attach-point\x3d"showJsonContentDiv"\x3e     \r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3c!--div class\x3d"operation-div" data-dojo-attach-point\x3d"operationDiv"\x3e\r\n      \x3cdiv class\x3d"operation-item-div  export-div jimu-btn" style\x3d"" data-dojo-attach-point\x3d"exportNode" data-dojo-attach-event\x3d"onclick:_onExportClick"\x3e${nls.download}\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"operation-item-div  download-div jimu-btn jimu-state-disabled" style\x3d"padding: 0px; display: none" data-dojo-attach-point\x3d"downloadNode"\x3e\r\n        \x3ca class\x3d"download-a" href\x3d"#" target\x3d"downloadTargetFrame" data-dojo-attach-point\x3d"downloadLinkNode"\x3e${nls.download}\x3c/a\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"operation-item-div save-div jimu-btn" data-dojo-attach-event\x3d"onclick:_onSaveClick"\x3e\r\n        ${nls.save}\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"operation-item-div cancel-div jimu-btn" data-dojo-attach-event\x3d"onclick:_onCancelClick"\x3e\r\n        ${nls.cancel}\r\n      \x3c/div\x3e\r\n    \x3c/div--\x3e\r\n  \x3c!--/div--\x3e\r\n\x3c/div\x3e\r\n'}});
define("dojo/_base/declare dojo/_base/array dojo/_base/html dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/AGOLTemplate.html dojo/on dojo/dom dojo/_base/lang dojo/dom-construct dojo/dom-style dojo/dom-class dojo/dom-attr dojo/json dojo/query dojo/Deferred dijit/form/Select ./ConfigNode ./CategoryManager ./ShowJsonCodePage ./Export builder/serviceUtils jimu/utils jimu/WidgetManager jimu/dijit/Message jimu/dijit/Popup jimu/portalUrlUtils builder/portalUtils jimu/dijit/LoadingShelter ./ExportMessage".split(" "),
function(G,v,q,H,I,J,l,K,e,c,h,w,r,A,n,x,B,C,L,M,N,O,y,P,Q,R,D,E,S,z){return G([H,I],{templateString:J,baseClass:"agol-template",configTree:null,nls:null,lastTemplateJson:null,postMixInProperties:function(){this.nls=e.mixin({},builderNls);this.nls=e.mixin(this.nls,this.plugin.nls);this.imageFolder=this.plugin.folderUrl+"/css/images/";this.arrowImgSrc=isRTL?this.imageFolder+"v_left.png":this.imageFolder+"v_right.png"},postCreate:function(){this.inherited(arguments)},startup:function(){K.setSelectable(this.contentPart,
!1);this.showJsonWidget=new M({},this.showJsonContentDiv);this.configTree=new C(this.appConfig,null,"app","",0);this.categoryManager=new L(this.configTree,this.appConfig,this.app.agolTemplateInfo);this.drawTree(this.configTree,this.treePart);this.drawCategoryPart();this.initWork()},drawTree:function(a,f){var d,b;d=this.drawDomNode(a,f);if(0!==a.childs.length)for(b=0;b<a.childs.length;b++)this.drawTree(a.childs[b],d)},drawDomNode:function(a,f){var d,b,k,g,p,m;m=this.categoryManager.getCategoryByField(a.absolutePath);
d=c.create("div",{"class":"tree-node-div",idAttr:a.id},f);a.traversal(e.hitch(this,function(a){if(this.categoryManager.getCategoryByField(a.absolutePath))return!0}))||h.set(d,"display","none");"leaf"===a.nodeType&&!m&&h.set(d,"color","#cccccc");"leaf"!==a.nodeType&&(k=c.create("div",{"class":"show-subnode-div jimu-float-leading"},d),g=c.create("img",{"class":"show-subnode-img",src:this.arrowImgSrc,alt:"img"},k));c.create("span",{"class":"line-label-span jimu-float-leading",innerHTML:a.label?a.label:
a.keyString},d);m&&"leaf"===a.nodeType&&(p=c.create("div",{"class":"to-right-div jimu-float-trailing"},d),c.create("img",{"class":"to-right-img",src:this.imageFolder+"add_field.png",alt:"img"},p),this.own(l(p,"click",e.hitch(this,function(b){h.set(p,"display","none");this._onToRightDiv(a,"add",d);b.stopPropagation();this._checkTemplateStatus()}))),-1!==m.findFieldFromDisplay(a.absolutePath)&&h.set(p,"display","none"));b=12*a.level;"leaf"===a.nodeType?isRTL?h.set(d,"paddingRight",b+17+"px"):h.set(d,
"paddingLeft",b+17+"px"):isRTL?h.set(d,"paddingRight",b+"px"):h.set(d,"paddingLeft",b+"px");b=c.create("div",{"class":"tree-node-subdiv"},f);h.set(b,"display","none");"leaf"!==a.nodeType?(h.set(d,"cursor","pointer"),this.own(l(d,"click",e.hitch(this,function(a,b,d){"none"===h.get(b,"display")?(h.set(b,"display","block"),r.set(d,"src",this.imageFolder+"v.png")):(h.set(b,"display","none"),r.set(d,"src",this.arrowImgSrc));-1!==a.absolutePath.search(/widgets\[[0-9]+\]_config$/)&&!a.jsonObject&&this.addWidgetConfigToConfigTree(a.absolutePath)},
a,b,g)))):m&&(h.set(d,"cursor","pointer"),this.own(l(d,"click",e.hitch(this,function(a,b){this._onToRightDiv(a,"notAdd",d);b.stopPropagation()},a))));a.lineDomNode=d;a.subLineDomNode=b;a.showSubDivDomNode=k;a.toRightDiv=p;0===a.level&&(q.setStyle(d,"display","none"),q.setStyle(b,"display","block"));return b},drawCategoryPart:function(){v.forEach(this.categoryManager.displayCategorys,function(a){this.drawCategory(a)},this)},drawCategory:function(a){var f,d,b,k,g,p,m;f=c.create("div",{"class":"category-div",
categoryDiv:a.name},this.categoryPart);k=c.create("div",{"class":"category-head-div",categoryHeadDiv:a.name},f);g=c.create("div",{"class":"category-fold-div jimu-float-leading"},k);m=c.create("img",{"class":"category-fold-img",src:this.arrowImgSrc,alt:"img"},g);c.create("div",{"class":"category-title-div jimu-float-leading",innerHTML:a.title},k);d=c.create("div",{"class":"category-oper-div jimu-float-trailing"},k);g=c.create("div",{"class":"category-oper-item-div category-moveup-div jimu-float-leading",
innerHTML:"\x3cimg src\x3d'"+this.imageFolder+"moveup.png' alt\x3d'img'\x3e\x3c/img\x3e"},d);p=c.create("div",{"class":"category-oper-item-div category-movedown-div jimu-float-leading",innerHTML:"\x3cimg src\x3d'"+this.imageFolder+"movedown.png' alt\x3d'img'\x3e\x3c/img\x3e"},d);d=c.create("div",{"class":"category-oper-item-div category-remove-div jimu-float-leading",innerHTML:"\x3cimg src\x3d'"+this.imageFolder+"delete01.png' alt\x3d'img'\x3e\x3c/img\x3e"},d);b=c.create("div",{"class":"fields-div",
fieldsDiv:a.name},f);this.own(l(g,"click",e.hitch(this,function(b){this.categoryManager.moveup(a)&&(c.empty(this.categoryPart),this.drawCategoryPart());this._changeHeighlightCategoryHead(a.name);b.stopPropagation();this._checkTemplateStatus()})));this.own(l(p,"click",e.hitch(this,function(b){this.categoryManager.movedown(a)&&(c.empty(this.categoryPart),this.drawCategoryPart());this._changeHeighlightCategoryHead(a.name);b.stopPropagation();this._checkTemplateStatus()})));this.own(l(d,"click",e.hitch(this,
function(b){this.categoryManager.removeCategoryFromDisplay(a);c.destroy(f);v.forEach(a.displayFields,function(a){var b=this.configTree.findNode(a.fieldPath);b&&(b.setTemplateField(a.fieldJson),b.toRightDiv&&h.set(b.toRightDiv,"display","block"))},this);a.displayFields=[];b.stopPropagation();this._checkTemplateStatus()})));this.own(l(k,"click",e.hitch(this,function(){"block"===h.get(b,"display")?(h.set(b,"display","none"),r.set(m,"src",this.arrowImgSrc)):(h.set(b,"display","block"),r.set(m,"src",this.imageFolder+
"v.png"));this._changeHeighlightCategoryHead(a.name)})));this.drawFields(a,f,b);h.set(b,"display","none")},drawFields:function(a,f,d){v.forEach(a.displayFields,function(b){this.drawField(a,f,d,b)},this)},addWidgetConfigToConfigTree:function(a){var f=new x,d=a.search(/widgets\[[0-9]+\]/),b=a.slice(d,a.length).indexOf("]"),d=a.slice(0,d+b+1);a=d+"_config";var d=this.configTree.findNode(d),c=this.configTree.findNode(a);a=this.fullAppConfig.getConfigElementById(d.jsonObject.id);P.getInstance().tryLoadWidgetConfig(a).then(e.hitch(this,
function(a){if(a){var b;c.jsonObject=a;a.geocoder&&a.geocoder.geocoders&&delete a.geocoder.geocoders;for(b in a)a.hasOwnProperty(b)&&(b=c.addChild(a[b],b,c.absolutePath,c.level),this.drawTree(b,c.subLineDomNode))}f.resolve()}));return f},drawField:function(a,f,d,b){var k,g,p,m,F,n,s,t;this.configTree.findNode(b.fieldPath);t=C.getDefaultTemplateField(b.fieldPath,b.fieldJson.type,b.fieldJson.label);for(k in b.fieldJson)b.fieldJson.hasOwnProperty(k)&&(t[k]=b.fieldJson[k]);k=c.create("div",{"class":"field-div",
fieldDiv:b.fieldPath},d);this.own(l(k,"click",e.hitch(this,function(a,b){function d(){c=this.configTree.findNode(l);f=q.position(this.treePart).y;k=q.position(c.lineDomNode).y;g=k-f;(0>g||g>h.get(this.categoryPart,"height"))&&c.lineDomNode.scrollIntoView(!1);this._changeHeighlightFieldDomNode(l);this._changeHeighlightTreeDomNode(c.lineDomNode);this._changeHeighlightCategoryHead(b.name)}var c,f,k,g,l=a.fieldPath;if(c=this.configTree.findNode(l)){for(;c;)h.set(c.subLineDomNode,"display","block"),c=
c.parentNode;e.hitch(this,d)()}else this.addWidgetConfigToConfigTree(l).then(e.hitch(this,function(){for(c=this.configTree.findNode(l);c;)h.set(c.subLineDomNode,"display","block"),c=c.parentNode;e.hitch(this,d)()}))},b,a)));a=c.create("div",{"class":"field-head-div"},k);c.create("span",{"class":"field-head-title-div",innerHTML:e.hitch(this,function(a){var b="",c=a.split("_"),d=e.clone(c);v.forEach(c,function(a,b){var f,e="";if(-1!==a.search(/widgets\[[0-9]+\]$/)||-1!==a.search(/groups\[[0-9]+\]$/)){for(f=
0;f<=b;f++)e+=c[f]+"_";f=this.configTree.findNode(e.slice(0,-1));d[b]=f.label}},this);for(a=1;a<d.length;a++)b+=d[a]+"_";return b.slice(0,-1)})(b.fieldPath)},a);p=c.create("div",{"class":"field-fold-div jimu-float-leading"},a);m=c.create("img",{"class":"field-fold-img",src:this.arrowImgSrc,alt:"img"},p);p=c.create("div",{"class":"field-oper-div jimu-float-trailing",innerHTML:"\x3cimg class\x3d'field-oper-img' src\x3d'"+this.imageFolder+"delete01.png' alt\x3d'img'\x3e\x3c/img\x3e"},a);n=c.create("div",
{"class":"field-oper-div jimu-float-trailing",innerHTML:"\x3cimg class\x3d'field-oper-img' src\x3d'"+this.imageFolder+"movedown.png' alt\x3d'img'\x3e\x3c/img\x3e"},a);F=c.create("div",{"class":"field-oper-div jimu-float-trailing",innerHTML:"\x3cimg class\x3d'field-oper-img' src\x3d'"+this.imageFolder+"moveup.png' alt\x3d'img'\x3e\x3c/img\x3e"},a);var u=c.create("div",{"class":"field-fixed-content-div",style:"display:none;"},k);c.create("span",{"class":"field-label-span",innerHTML:this.nls.fieldLabel},
u);g=c.create("input",{"class":"jimu-input field-label-input",type:"text",value:t.label},u);this.own(l(g,"change",e.hitch(this,function(a,b){this._onFieldChange(a,{key:"label",value:b.value})},b.fieldPath,g)));c.create("span",{"class":"field-type-span",innerHTML:this.nls.fieldType},u);g=(new B({name:"selectFieldType","class":"field-type-select",options:[{label:"string",value:"string"},{label:"boolean",value:"boolean"},{label:"number",value:"number"},{label:"options",value:"options"}],value:t.type})).placeAt(u);
s=c.create("div",{"class":"field-content-div",style:"display:none;"},k);this.drawFieldContent(b.fieldPath,t,s,g.getValue());this.own(l(g,"change",e.hitch(this,function(a,b,c,d){this.drawFieldContent(a,b,c,d);this._onFieldChange(a,{key:"type",value:d});h.set(c,"display","block")},b.fieldPath,t,s)));this.own(l(a,"click",e.hitch(this,function(){"block"===h.get(s,"display")?(h.set(s,"display","none"),h.set(u,"display","none"),r.set(m,"src",this.arrowImgSrc)):(h.set(s,"display","block"),h.set(u,"display",
"block"),r.set(m,"src",this.imageFolder+"v.png"))})));this.own(l(p,"click",e.hitch(this,function(a,b,d,f){var k=a.fieldPath,g=this.configTree.findNode(k);g?(g.setTemplateField(a.fieldJson),g.toRightDiv&&h.set(g.toRightDiv,"display","block")):this.addWidgetConfigToConfigTree(k).then(e.hitch(this,function(){var b=this.configTree.findNode(k);a.fieldJson&&b.setTemplateField(a.fieldJson)}));g=this.categoryManager.getCategoryByField(k);g.removeFieldFromDisplay(k);c.destroy(b);g.displayIsEmpty()&&(this.categoryManager.removeCategoryFromDisplay(g),
c.destroy(d));f.stopPropagation();this._checkTemplateStatus()},b,k,f)));this.own(l(F,"click",e.hitch(this,function(a,b,d){var e=this.categoryManager.getCategoryByField(a);e.moveup(a)&&(c.empty(b),this.drawFields(e,f,b),this._changeHeighlightFieldDomNode(a));d.stopPropagation();this._checkTemplateStatus()},b.fieldPath,d)));this.own(l(n,"click",e.hitch(this,function(a,b,d){var e=this.categoryManager.getCategoryByField(a);e.movedown(a)&&(c.empty(b),this.drawFields(e,f,b),this._changeHeighlightFieldDomNode(a));
d.stopPropagation();this._checkTemplateStatus()},b.fieldPath,d)))},drawFieldContent:function(a,f,d,b){var k,g,h,m;c.empty(d);c.create("span",{"class":"field-tooltip-span",innerHTML:this.nls.tooltip},d);k=c.create("input",{"class":"jimu-input field-tooltip-input",type:"text",value:f.tooltip},d);this.own(l(k,"change",e.hitch(this,function(a,b){this._onFieldChange(a,{key:"tooltip",value:b.value})},a,k)));c.create("br",{},d);"string"===b?(c.create("span",{"class":"field-string-ph-span",innerHTML:this.nls.placeholder},
d),b=c.create("input",{"class":"jimu-input field-string-ph-input",type:"text",value:f.placeHolder},d),this.own(l(b,"change",e.hitch(this,function(a,b){this._onFieldChange(a,{key:"placeHolder",value:b.value})},a,b))),b=c.create("div",{"class":"field-text-type-div"},d),c.create("span",{"class":"field-text-type-span",innerHTML:this.nls.textBoxType},b),f=(new B({name:"stringOptions","class":"field-string-options",options:[{label:"richtext",value:"richtext"},{label:"textarea",value:"textarea"},{label:"textbox",
value:"textbox"}],value:f.stringFieldOption})).placeAt(b),this.own(l(f,"change",e.hitch(this,function(a,b){this._onFieldChange(a,{key:"stringFieldOption",value:b})},a)))):"number"===b?(c.create("span",{"class":"field-num-min-span",innerHTML:this.nls.minvalue},d),g=c.create("input",{"class":"jimu-input field-num-input field-num-min-input",type:"text",value:f.constraints.min},d),c.create("br",{},d),c.create("span",{"class":"field-num-max-span",innerHTML:this.nls.maxvalue},d),h=c.create("input",{"class":"jimu-input field-num-input field-num-max-input",
type:"text",value:f.constraints.max},d),c.create("br",{},d),c.create("span",{"class":"field-num-places-span",innerHTML:this.nls.places},d),m=c.create("input",{"class":"jimu-input field-num-input field-num-places-input",type:"text",value:f.constraints.places},d),this.own(l(g,"change",e.hitch(this,function(a){this._onFieldChange(a,{key:"constraints",value:{min:g.value,max:h.value,places:m.value}})},a))),this.own(l(h,"change",e.hitch(this,function(a){this._onFieldChange(a,{key:"constraints",value:{min:g.value,
max:h.value,places:m.value}})},a))),this.own(l(m,"change",e.hitch(this,function(a){this._onFieldChange(a,{key:"constraints",value:{min:g.value,max:h.value,places:m.value}})},a)))):"options"===b&&(b=c.create("div",{"class":"field-options-add-div"},d),k=c.create("div",{"class":"field-options-add-content"},b),c.create("div",{"class":"field-options-add-img-div jimu-float-leading",innerHTML:"\x3cimg src\x3d'"+this.imageFolder+"add_link.png' alt\x3d'img'\x3e\x3c/img\x3e"},k),c.create("div",{"class":"field-options-add-text-div jimu-float-leading",
innerHTML:this.nls.addNewOption},k),v.forEach(f.options,function(b){this._onFieldOptionsAdd(a,d,b.label,b.value)},this),this.own(l(b,"click",e.hitch(this,this._onFieldOptionsAdd,a,d,"",""))))},_changeHeighlightFieldDomNode:function(a){n(".field-div",this.categoryPart).removeClass("field-heighlight-div");w.add(n('div[fieldDiv\x3d"'+a+'"]',this.categoryPart)[0],"field-heighlight-div")},_changeHeighlightTreeDomNode:function(a){this.heighlightTreeDomNode&&w.remove(this.heighlightTreeDomNode,"tree-node-heighlight-div");
w.add(a,"tree-node-heighlight-div");this.heighlightTreeDomNode=a},_changeHeighlightCategoryHead:function(a){n(".category-head-div",this.categoryPart).removeClass("category-head-div-selected");a=n("div[categoryHeadDiv\x3d'"+a+"']",this.categoryPart)[0];q.addClass(a,"category-head-div-selected")},_onToRightDiv:function(a,c,d){var b,e,g=this.categoryManager.getCategoryByField(a.absolutePath);b=this.categoryManager.findDisplayCategory(g.name);e={fieldPath:a.absolutePath,fieldJson:a.getTemplateField()};
if(-1===b){if("add"!==c)return;this.categoryManager.addCategoryToDisplay(g);g.addFieldToDisplay(e);this.drawCategory(g);b=n("div[fieldsDiv\x3d'"+g.name+"']",this.categoryPart)[0]}else if(-1===g.findFieldFromDisplay(a.absolutePath)){if("add"!==c)return;g.addFieldToDisplay(e);c=n("div[categoryDiv\x3d'"+g.name+"']",this.categoryPart)[0];b=n("div[fieldsDiv\x3d'"+g.name+"']",this.categoryPart)[0];this.drawField(g,c,b,e)}else b=n("div[fieldsDiv\x3d'"+g.name+"']",this.categoryPart)[0];h.set(b,"display",
"block");e=n('div[fieldDiv\x3d"'+a.absolutePath+'"]',this.categoryPart)[0];this._changeHeighlightCategoryHead(g.name);this._changeHeighlightFieldDomNode(a.absolutePath);this._changeHeighlightTreeDomNode(d);a=q.position(this.categoryPart).y;a=q.position(e).y-a;(0>a||a>h.get(this.categoryPart,"height"))&&e.scrollIntoView(!1)},_onFieldChange:function(a,c){var d=this.configTree.findNode(a),b=this.categoryManager.getCategoryByField(a).getDisplayField(a);b.fieldJson[c.key]=c.value;d.templateField=b.fieldJson;
this._checkTemplateStatus()},_onFieldOptionsAdd:function(a,f,d,b){var k=c.create("div",{"class":"field-options-div"},f);c.create("div",{"class":"field-options-label-div jimu-float-leading",innerHTML:this.nls.label},k);d=c.create("input",{"class":"jimu-input field-options-label-input jimu-float-leading",type:"text",value:d},k);this.own(l(d,"change",e.hitch(this,function(a){this._onFieldChange(a,{key:"options",value:this._getFieldOptions(f)})},a)));c.create("div",{"class":"field-options-value-div jimu-float-leading",
innerHTML:this.nls.value},k);b=c.create("input",{"class":"jimu-input field-options-value-input jimu-float-leading",type:"text",value:b},k);this.own(l(b,"change",e.hitch(this,function(a){this._onFieldChange(a,{key:"options",value:this._getFieldOptions(f)})},a)));b=c.create("div",{"class":"field-options-remove-div jimu-float-leading",innerHTML:"\x3cimg src\x3d'"+this.imageFolder+"delete_search.png' alt\x3d'img'\x3e\x3c/img\x3e"},k);this.own(l(b,"click",e.hitch(this,function(a){c.destroy(k);this._onFieldChange(a,
{key:"options",value:this._getFieldOptions(f)})},a)))},_getFieldOptions:function(a){var c=[];n(".field-options-div",a).forEach(e.hitch(this,function(a){c.push({label:n(".field-options-label-input",a).attr("value")[0],value:n(".field-options-value-input",a).attr("value")[0]})}));return c},_onReviewJsonDivClick:function(){var a=this.categoryManager.getTemplateJson();this.showJsonWidget.setConfig(a);r.set(this.rightPartHeadText,"innerHTML",this.nls.rightPartHead2);h.set(this.showJsonDiv,"display","block");
h.set(this.reviewJsonDiv,"display","none");h.set(this.reviewJsonBackDiv,"display","block")},_onReviewJsonBackDivClick:function(){r.set(this.rightPartHeadText,"innerHTML",this.nls.rightPartHead);h.set(this.reviewJsonDiv,"display","block");h.set(this.reviewJsonBackDiv,"display","none");h.set(this.showJsonDiv,"display","none")},_saveAgolTemplate:function(a){var c=new x,d=A.stringify(this.categoryManager.getTemplateJson("fullJson")),b={itemId:a?a:this.app.agolTemplateInfo?this.app.agolTemplateInfo.itemId:
null,json:d};O.saveAgolTemplate(this.app,b).then(e.hitch(this,function(){this.app.agolTemplateInfo=b;this.lastTemplateJson=this.categoryManager.getTemplateJson();c.resolve()}),function(a){new Q({message:a});c.reject()});return c},_onDownloadNodeClick:function(){},_onExportClick:function(){var a=A.stringify(this.categoryManager.getTemplateJson());this.app.agolTemplateInfo&&this.app.agolTemplateInfo.itemId?this._updateAgolTemplate(a):this._exportAgolTemplate(a)},_updateAgolTemplate:function(a){var c=
new x,d=!y.isEqual(this.lastTemplateJson,this.categoryManager.getTemplateJson());this.loading.show(this.nls.updating);d?this._saveAgolTemplate().then(e.hitch(this,function(){this._disablePopupButton(1,this.nls.saved);c.resolve()})):c.resolve();c.then(e.hitch(this,function(){E.getPortal(window.portalUrl).getUser().then(e.hitch(this,function(b){b.updateItem(this.app.agolTemplateInfo.itemId,{text:a}).then(e.hitch(this,function(){this.loading.hide();z._exportedMessage({itemId:this.app.agolTemplateInfo.itemId,
message:this.nls.exportSuccessfulUpdate},this.nls.exportMessageTitleUpdate,this.nls)}),e.hitch(this,function(a){this.loading.hide();console.error(a.message||a);z._exportedMessage({itemId:null,message:this.nls.exportTemplateFailed7},this.nls.exportMessageTitleUpdate,this.nls)}))}),e.hitch(this,function(a){this.loading.hide();console.error(a.message||a);z._exportedMessage({itemId:null,message:this.nls.exportTemplateFailed6},this.nls.exportMessageTitleUpdate,this.nls)}))}))},_exportAgolTemplate:function(a){var c=
"";window.isXT?c="http://"+window.location.host+path+"apps/"+this.app.id:(c=D.getStandardPortalUrl(window.portalUrl),c=D.setProtocol(c,"http:"),c=c+"/apps/webappviewer/index.html?id\x3d"+this.app.id);(new N({_templateUrl:c,_temlateJson:a,pluginManager:this.plugin.pluginManager,nls:this.nls,_afterAddItemOfExportCallback:e.hitch(this,this._afterAddItemOfExportCallback)})).startup()},_afterAddItemOfExportCallback:function(a){this._saveAgolTemplate(a).then(e.hitch(this,function(){this._disablePopupButton(1,
this.nls.saved);q.setAttr(this.popup.enabledButtons[0],"innerHTML",this.nls.update)}))},_onSaveClick:function(){q.setAttr(this.popup.enabledButtons[1],"innerHTML",this.nls.saving);this._saveAgolTemplate().then(e.hitch(this,function(){this._disablePopupButton(1,this.nls.saved)}))},_onCancelClick:function(){if(y.isEqual(this.lastTemplateJson,this.categoryManager.getTemplateJson()))this._closePopup(),this.destroyRecursive();else var a=new R({content:"\x3cdiv\x3e\x3cimg class\x3d'alert-image jimu-float-leading'src\x3d'"+
this.imageFolder+"alert.png' style\x3d'margin-left:20px;margin-right:20px;'\x3e\x3c/img\x3e\x3cspan style\x3d'display:inline-block;width:285px'\x3e"+this.nls.unSaveMeg+"\x3c/span\x3e\x3c/div\x3e",titleLabel:this.nls.cancelPopupTitle,width:"425",autoHeight:!0,buttons:[{label:this.nls.save,onClick:e.hitch(this,function(){this._saveAgolTemplate().then(e.hitch(this,function(){a.close();this._closePopup();this.destroyRecursive()}))})},{label:this.nls.doNotSave,onClick:e.hitch(this,function(){a.close();
this._closePopup();this.destroyRecursive()})},{label:this.nls.cancel,onClick:e.hitch(this,function(){a.close()})}]})},_closePopup:function(){this.popup&&(this.popup.closeTemplate=!0,this.popup.close())},_checkTemplateStatus:function(){y.isEqual(this.lastTemplateJson,this.categoryManager.getTemplateJson())||this._enablePopupButton(1,this.nls.save)},_disablePopupButton:function(a,c){this.popup.disableButton(a);q.setAttr(this.popup.disabledButtons[a],"innerHTML",c)},_enablePopupButton:function(a,c){this.popup.enableButton(a);
q.setAttr(this.popup.enabledButtons[a],"innerHTML",c)},_initPopup:function(){this.app.agolTemplateInfo&&this.app.agolTemplateInfo.itemId&&E.getPortal(window.portalUrl).getItemById(this.app.agolTemplateInfo.itemId).then(e.hitch(this,function(){q.setAttr(this.popup.enabledButtons[0],"innerHTML",this.nls.update)}),e.hitch(this,function(){this.app.agolTemplateInfo.itemId=null;q.setAttr(this.popup.enabledButtons[0],"innerHTML",this.nls.download)}));this.popup.disableButton(1);this.popup.onClose=e.hitch(this,
function(){if(this.popup.closeTemplate)return!0;this._onCancelClick();return!1})},initWork:function(){this.lastTemplateJson=this.categoryManager.getTemplateJson();this._initPopup();this.loading=new S({hidden:!0});this.loading.placeAt(this.popup.domNode);this.loading.startup()}})});