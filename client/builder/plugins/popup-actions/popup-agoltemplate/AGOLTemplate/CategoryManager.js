//>>built
define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/json ./ConfigNode ./Category".split(" "),function(n,p,f,q,l,k){return n([],{categorys:null,displayCategorys:null,constructor:function(a,c,b){b=b&&b.json?b.json:null;this.categorys=[];this.displayCategorys=[];this.initCategorys(c,a);this.deserialize(b,a)},initCategorys:function(a,c){var b=new k(c,"Attribute","Attribute",["app_title","app_subtitle","app_logo","app_links"],[],["app_title","app_subtitle"]);this.categorys.push(b);f.forEach(a.widgetOnScreen.widgets,
function(a,b){var g="ScreenWidget_"+a.id,d="app_widgetOnScreen_widgets["+b+"]",d=[d+"_label",d+"_visible",d+"_config"],e=[];a.uri&&this.categorys.push(new k(c,g,a.label+" widget",d,e))},this);f.forEach(a.widgetOnScreen.groups,function(a,b){var g="ScreenWidgetGroup_"+a.id,d="app_widgetOnScreen_groups["+b+"]",e=[d+"_label",d+"_visible"];f.forEach(a.widgets,function(a,b){e.push(d+"_widgets["+b+"]_label");e.push(d+"_widgets["+b+"]_visible");e.push(d+"_widgets["+b+"]_config")});this.categorys.push(new k(c,
g,a.label,e,[]))},this);f.forEach(a.widgetPool.widgets,function(a,b){var g="widgetPoolWidget_"+a.id,d="app_widgetPool_widgets["+b+"]",d=[d+"_label",d+"_visible",d+"_config"],e=[];a.uri&&this.categorys.push(new k(c,g,a.label+" widget",d,e))},this);f.forEach(a.widgetPool.groups,function(a,b){var g="widgetPoolGroup_"+a.id,d="app_widgetPool_groups["+b+"]",e=[d+"_label",d+"_visible"];f.forEach(a.widgets,function(a,b){e.push(d+"_widgets["+b+"]_label");e.push(d+"_widgets["+b+"]_visible");e.push(d+"_widgets["+
b+"]_config")});this.categorys.push(new k(c,g,a.label,e,[]))},this);this.displayCategorys.push(b)},getCategoryByName:function(a){return this.categorys[this.findCategory(a)]},getCategoryByField:function(a){var c;for(c=0;c<this.categorys.length;c++)if(this.categorys[c].hasField(a))return this.categorys[c];return null},findCategory:function(a){return this._find(a,this.categorys)},findDisplayCategory:function(a){return this._find(a,this.displayCategorys)},_find:function(a,c){var b;for(b=0;b<c.length&&
c[b].name!==a;b++);return b===c.length?-1:b},addCategoryToDisplay:function(a){-1===this.findDisplayCategory(a.name)&&this.displayCategorys.push(a)},removeCategoryFromDisplay:function(a){a=this.findDisplayCategory(a.name);0<=a&&this.displayCategorys.splice(a,1)},moveup:function(a){var c;a=this.findDisplayCategory(a.name);return 0<a?(c=this.displayCategorys[a],this.displayCategorys[a]=this.displayCategorys[a-1],this.displayCategorys[a-1]=c,!0):!1},movedown:function(a){var c;a=this.findDisplayCategory(a.name);
return 0<=a&&a<this.displayCategorys.length-1?(c=this.displayCategorys[a],this.displayCategorys[a]=this.displayCategorys[a+1],this.displayCategorys[a+1]=c,!0):!1},getTemplateJson:function(a){var c={configurationSettings:[],values:{}};f.forEach(this.displayCategorys,function(b,h){var m={category:b.title,fields:[]};"fullJson"===a&&(m.categoryName=b.name);f.forEach(b.displayFields,function(b,d){var e=p.clone(b.fieldJson);if(!a||"fullJson"!==a)delete e.id,delete e.fieldPath;m.fields[d]=e;c.values[e.fieldName]=
l.getDefaultValue(b.fieldJson.fieldName)},this);c.configurationSettings[h]=m},this);return c},deserialize:function(a,c){if(a){f.forEach(this.displayCategorys,function(a){a.displayFields=[]});this.displayCategorys=[];a=q.parse(a);f.forEach(a.configurationSettings,function(a){var b=this.getCategoryByName(a.categoryName),d=0;b&&(d=b.deserialize(a.fields,c),0<d&&this.displayCategorys.push(b))},this);var b,h=a.values;for(b in h)h.hasOwnProperty(b)&&("function"!==typeof h[b]&&!l.defaultValueExisted(b))&&
l.setDefaultValue(null,h[b],b)}}})});